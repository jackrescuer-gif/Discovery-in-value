<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞–π–¥–∂–µ—Å—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ Discovery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --mck-blue-900: #051c2c;
            --mck-blue-800: #0a2f4c;
            --mck-blue-700: #0f4c75;
            --mck-blue-600: #147bbc;
            --mck-blue-500: #1e9fd9;
            --mck-blue-300: #9dd4f2;
            --mck-teal: #00a9b5;
            --mck-coral: #ff6b6b;
            --mck-gold: #ffb800;
            --mck-green: #2e7d32;
            --mck-gray-100: #f8f9fa;
            --mck-gray-200: #e9ecef;
            --mck-gray-300: #dee2e6;
            --mck-gray-600: #6c757d;
            --mck-gray-900: #212529;
            --radius: 10px;
            --shadow-soft: 0 2px 12px rgba(5, 28, 44, 0.08);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--mck-gray-100);
            color: var(--mck-gray-900);
            line-height: 1.45;
            padding: 18px;
            opacity: 1;
            transition: opacity 0.18s ease;
        }
        body.page-leaving { opacity: 0; }

        .page {
            max-width: 1480px;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .header-nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .back-link {
            color: #fff;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.45);
            opacity: 0.92;
            transition: background 0.2s;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .audience-pill {
            margin-top: 0;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.14);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 0.82rem;
            color: rgba(255, 255, 255, 0.95);
        }

        .header {
            background: linear-gradient(135deg, var(--mck-blue-900), var(--mck-blue-800));
            color: #fff;
            border-radius: 14px;
            box-shadow: var(--shadow-soft);
            padding: 28px;
            margin-bottom: 14px;
        }

        .header h1 {
            font-size: 1.85rem;
            font-weight: 600;
            margin-bottom: 10px;
            letter-spacing: -0.01em;
        }

        .header p {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.9);
            max-width: 1100px;
        }

        .action-title {
            margin-top: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 10px;
            padding: 12px 14px;
            font-size: 0.93rem;
            line-height: 1.5;
        }

        .filter-bar {
            position: sticky;
            top: 10px;
            z-index: 10;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(4px);
            border: 1px solid var(--mck-gray-300);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            padding: 12px;
            display: grid;
            grid-template-columns: repeat(5, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 14px;
        }

        .filter-item label {
            font-size: 0.75rem;
            color: var(--mck-gray-600);
            margin-bottom: 4px;
            display: block;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .filter-item select {
            width: 100%;
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            padding: 9px 10px;
            background: #fff;
            color: var(--mck-gray-900);
            font-size: 0.86rem;
            outline: none;
        }

        .filter-item select:focus {
            border-color: var(--mck-blue-500);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(8, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 14px;
        }

        .hero-summary {
            border: 1px solid var(--mck-gray-300);
            border-radius: var(--radius);
            background: #fff;
            box-shadow: var(--shadow-soft);
            padding: 12px;
            margin-bottom: 12px;
        }

        .hero-topline {
            display: grid;
            grid-template-columns: repeat(3, minmax(160px, 1fr));
            gap: 10px;
        }

        .hero-kpi-card {
            border: 1px solid var(--mck-gray-300);
            border-radius: 10px;
            padding: 10px;
            background: #fff;
        }

        .hero-kpi-card h3 {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--mck-gray-600);
            margin-bottom: 6px;
        }

        .hero-kpi-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--mck-blue-900);
            margin-bottom: 4px;
        }

        .hero-kpi-state {
            font-size: 0.78rem;
            font-weight: 600;
        }

        .hero-kpi-card.status-danger {
            border-color: rgba(198, 40, 40, 0.45);
            background: #fff8f8;
        }
        .hero-kpi-card.status-danger .hero-kpi-state { color: #c62828; }

        .hero-kpi-card.status-warn {
            border-color: rgba(245, 124, 0, 0.45);
            background: #fffcf6;
        }
        .hero-kpi-card.status-warn .hero-kpi-state { color: #ad6800; }

        .hero-kpi-card.status-ok {
            border-color: rgba(46, 125, 50, 0.45);
            background: #f4fbf4;
        }
        .hero-kpi-card.status-ok .hero-kpi-state { color: #2e7d32; }

        .hero-insight {
            margin-top: 10px;
            border-radius: 9px;
            border: 1px solid rgba(20, 123, 188, 0.26);
            background: #f7fbff;
            color: var(--mck-blue-800);
            font-size: 0.86rem;
            padding: 9px 11px;
            font-weight: 600;
        }

        .section-nav {
            position: sticky;
            top: 84px;
            z-index: 9;
            background: rgba(255, 255, 255, 0.94);
            backdrop-filter: blur(3px);
            border: 1px solid var(--mck-gray-300);
            border-radius: 9px;
            box-shadow: var(--shadow-soft);
            padding: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 7px;
            margin-bottom: 12px;
        }

        .section-link {
            text-decoration: none;
            color: var(--mck-blue-800);
            border: 1px solid var(--mck-gray-300);
            background: #fff;
            border-radius: 8px;
            padding: 6px 9px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .section-link:hover {
            border-color: var(--mck-blue-500);
            color: var(--mck-blue-900);
        }

        .dashboard-section {
            margin-bottom: 14px;
        }

        .section-head {
            margin-bottom: 8px;
        }

        .section-head h2 {
            color: var(--mck-blue-900);
            font-size: 1.08rem;
            margin-bottom: 3px;
            letter-spacing: -0.01em;
        }

        .section-head p {
            font-size: 0.84rem;
            color: var(--mck-gray-600);
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(300px, 1fr));
            gap: 12px;
        }

        .section-card {
            min-height: 100%;
        }

        .category-disclaimer {
            background: #fff;
            border: 1px solid var(--mck-gray-300);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            padding: 12px;
            margin-bottom: 14px;
        }

        .category-disclaimer h3 {
            font-size: 0.9rem;
            color: var(--mck-blue-800);
            margin-bottom: 8px;
        }

        .category-disclaimer p {
            font-size: 0.8rem;
            color: var(--mck-gray-600);
            margin-bottom: 10px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, minmax(160px, 1fr));
            gap: 8px;
        }

        .category-item {
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            padding: 8px 9px;
            background: #fbfdff;
        }

        .category-item strong {
            display: block;
            margin-bottom: 3px;
            color: var(--mck-blue-800);
            font-size: 0.83rem;
        }

        .category-item span {
            font-size: 0.77rem;
            color: var(--mck-gray-600);
            line-height: 1.35;
        }

        .kpi-card {
            background: #fff;
            border: 1px solid var(--mck-gray-300);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            padding: 12px;
            min-height: 124px;
        }

        .kpi-label {
            font-size: 0.71rem;
            color: var(--mck-gray-600);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--mck-blue-900);
            margin-bottom: 6px;
        }

        .kpi-delta {
            font-size: 0.78rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .kpi-target {
            font-size: 0.73rem;
            color: var(--mck-gray-600);
        }

        .kpi-state {
            font-size: 0.72rem;
            font-weight: 600;
            margin-top: 3px;
        }

        .kpi-state.ok {
            color: var(--mck-green);
        }

        .kpi-state.warn {
            color: #c62828;
        }

        .delta-positive {
            color: var(--mck-green);
        }

        .delta-negative {
            color: #c62828;
        }

        .delta-neutral {
            color: var(--mck-gray-600);
        }

        .layout-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 12px;
        }

        .card {
            background: #fff;
            border: 1px solid var(--mck-gray-300);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            padding: 14px;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .card:hover {
            transform: translateY(-1px);
            border-color: rgba(20, 123, 188, 0.35);
            box-shadow: 0 8px 24px rgba(5, 28, 44, 0.1);
        }

        .span-12 { grid-column: span 12; }
        .span-8 { grid-column: span 8; }
        .span-6 { grid-column: span 6; }
        .span-4 { grid-column: span 4; }

        .section-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--mck-blue-600);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .card h2 {
            font-size: 1.02rem;
            font-weight: 600;
            color: var(--mck-blue-800);
            margin-bottom: 5px;
            letter-spacing: -0.01em;
        }

        .card p.subtitle {
            font-size: 0.85rem;
            color: var(--mck-gray-600);
            margin-bottom: 10px;
        }

        .chart-wrap {
            min-height: 250px;
            position: relative;
        }

        .chart-wrap.tall {
            min-height: 320px;
        }

        .mini-bars {
            display: grid;
            gap: 8px;
            margin-top: 6px;
        }

        .mini-bar {
            display: grid;
            grid-template-columns: 180px 1fr 72px;
            align-items: center;
            gap: 8px;
            font-size: 0.82rem;
        }

        .mini-track {
            height: 9px;
            background: var(--mck-gray-200);
            border-radius: 999px;
            overflow: hidden;
        }

        .mini-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--mck-blue-600), var(--mck-blue-500));
        }

        .cost-readout {
            display: grid;
            gap: 7px;
            margin-top: 10px;
        }

        .cost-row {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            gap: 10px;
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 0.81rem;
            background: #fff;
        }

        .cost-row.clickable {
            cursor: pointer;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        .cost-row.clickable:hover {
            border-color: var(--mck-blue-500);
            background: #f8fbff;
        }

        .cost-row.active {
            border-color: var(--mck-blue-600);
            background: #edf6fd;
        }

        .cost-row .cost-main {
            font-weight: 600;
            color: var(--mck-gray-900);
        }

        .cost-row .cost-meta {
            color: var(--mck-gray-600);
            font-size: 0.78rem;
            margin-top: 2px;
        }

        .cost-row .cost-status {
            font-size: 0.78rem;
            font-weight: 700;
            text-align: right;
        }

        .cost-row .cost-status.ok {
            color: var(--mck-green);
        }

        .cost-row .cost-status.over {
            color: #c62828;
        }

        .insight-list {
            margin-top: 6px;
            display: grid;
            gap: 8px;
        }

        .insight-item {
            border-left: 4px solid var(--mck-blue-500);
            background: #f7fbff;
            border-radius: 8px;
            padding: 10px;
            font-size: 0.85rem;
        }

        .insight-item.warn {
            border-left-color: var(--mck-gold);
            background: #fffbf1;
        }

        .insight-item.risk {
            border-left-color: var(--mck-coral);
            background: #fff8f8;
        }

        .insight-item.good {
            border-left-color: var(--mck-green);
            background: #f4fbf4;
        }

        .inline-alerts {
            display: grid;
            gap: 6px;
            margin-bottom: 10px;
        }

        .inline-alert {
            border-radius: 7px;
            padding: 7px 9px;
            font-size: 0.8rem;
            border: 1px solid rgba(245, 124, 0, 0.45);
            background: #fffbf3;
            color: #925100;
            font-weight: 600;
        }

        .inline-alert.ok {
            border-color: rgba(46, 125, 50, 0.35);
            background: #f4fbf4;
            color: #2e7d32;
        }

        .action-card-list {
            display: grid;
            gap: 8px;
        }

        .action-card {
            border: 1px solid var(--mck-gray-300);
            border-radius: 9px;
            background: #fff;
            box-shadow: var(--shadow-soft);
            padding: 10px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 10px;
            align-items: start;
        }

        .priority-badge {
            min-width: 34px;
            text-align: center;
            border-radius: 999px;
            padding: 4px 7px;
            font-size: 0.74rem;
            font-weight: 700;
            border: 1px solid transparent;
        }

        .priority-badge.p1 {
            color: #c62828;
            background: #fff2f2;
            border-color: rgba(198, 40, 40, 0.35);
        }

        .priority-badge.p2 {
            color: #8a5800;
            background: #fff9ec;
            border-color: rgba(245, 124, 0, 0.35);
        }

        .priority-badge.p3 {
            color: #2e7d32;
            background: #f2faf2;
            border-color: rgba(46, 125, 50, 0.35);
        }

        .action-title {
            font-size: 0.88rem;
            color: var(--mck-blue-900);
            font-weight: 700;
            margin-bottom: 4px;
        }

        .action-text {
            color: var(--mck-gray-600);
            font-size: 0.8rem;
            margin-bottom: 6px;
        }

        .action-meta {
            display: flex;
            gap: 7px;
            flex-wrap: wrap;
            align-items: center;
        }

        .metric-badge {
            border: 1px solid var(--mck-gray-300);
            border-radius: 999px;
            padding: 3px 7px;
            font-size: 0.73rem;
            color: var(--mck-blue-800);
            background: #f8fbff;
            font-weight: 600;
        }

        .metric-link {
            font-size: 0.75rem;
            color: var(--mck-blue-700);
            text-decoration: none;
            font-weight: 600;
        }

        .metric-link:hover { text-decoration: underline; }

        .action-status {
            border-radius: 999px;
            padding: 3px 7px;
            font-size: 0.73rem;
            font-weight: 700;
            border: 1px solid var(--mck-gray-300);
            color: var(--mck-gray-600);
            background: #f8f9fa;
            white-space: nowrap;
        }

        .action-status.in-progress {
            color: #8a5800;
            background: #fff9ec;
            border-color: rgba(245, 124, 0, 0.35);
        }

        .action-status.new {
            color: #c62828;
            background: #fff2f2;
            border-color: rgba(198, 40, 40, 0.35);
        }

        .action-status.done {
            color: #2e7d32;
            background: #f2faf2;
            border-color: rgba(46, 125, 50, 0.35);
        }

        .chip-filter {
            margin-top: 8px;
            display: flex;
            gap: 7px;
            flex-wrap: wrap;
        }

        .chip-btn {
            border: 1px solid var(--mck-gray-300);
            border-radius: 999px;
            padding: 5px 10px;
            font-size: 0.75rem;
            background: #fff;
            color: var(--mck-blue-800);
            cursor: pointer;
            font-weight: 600;
        }

        .chip-btn:hover {
            border-color: var(--mck-blue-500);
            color: var(--mck-blue-900);
        }

        .chip-btn.active {
            border-color: var(--mck-blue-700);
            background: #edf6fd;
            color: var(--mck-blue-900);
        }

        .bottleneck-line {
            margin-top: 8px;
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 0.8rem;
            color: var(--mck-gray-600);
            background: #f8fbff;
        }

        .data-footer {
            border: 1px solid var(--mck-gray-300);
            border-radius: var(--radius);
            box-shadow: var(--shadow-soft);
            background: #fff;
            padding: 12px;
        }

        .data-footer-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(280px, 1fr));
            gap: 10px;
        }

        .data-footer-block h3 {
            color: var(--mck-blue-800);
            font-size: 0.9rem;
            margin-bottom: 7px;
        }

        .footer-thresholds {
            display: grid;
            gap: 7px;
        }

        .footer-threshold-item {
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            padding: 8px 9px;
            background: #f8fbff;
            font-size: 0.79rem;
        }

        .footer-threshold-item strong {
            color: var(--mck-blue-800);
            display: block;
            margin-bottom: 2px;
            font-size: 0.82rem;
        }

        .data-quality {
            display: grid;
            grid-template-columns: repeat(3, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .threshold-grid {
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }

        .threshold-item {
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            background: #f8fbff;
            padding: 9px;
            font-size: 0.8rem;
        }

        .threshold-item strong {
            display: block;
            font-size: 0.85rem;
            color: var(--mck-blue-800);
            margin-bottom: 2px;
        }

        .quality-box {
            border: 1px solid var(--mck-gray-300);
            border-radius: 8px;
            padding: 9px;
            font-size: 0.81rem;
        }

        .quality-box strong {
            display: block;
            font-size: 1rem;
            margin-bottom: 2px;
            color: var(--mck-blue-800);
        }

        .footer-note {
            margin-top: 12px;
            font-size: 0.76rem;
            color: var(--mck-gray-600);
            display: flex;
            justify-content: space-between;
            gap: 8px;
            flex-wrap: wrap;
        }

        .dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .legend-row {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            font-size: 0.8rem;
            color: var(--mck-gray-600);
            margin-top: 6px;
        }

        body.embed-mode {
            padding: 0;
            background: #fff;
        }
        body.embed-mode .page {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        body.embed-mode .header,
        body.embed-mode .hero-summary,
        body.embed-mode .section-nav,
        body.embed-mode .filter-bar,
        body.embed-mode .category-disclaimer,
        body.embed-mode .kpi-grid,
        body.embed-mode .data-footer,
        body.embed-mode .footer-note,
        body.embed-mode .card:not(.embed-active) {
            display: none !important;
        }
        body.embed-mode .dashboard-section {
            display: none !important;
        }
        body.embed-mode .dashboard-section.embed-section {
            display: block !important;
        }
        body.embed-mode .dashboard-section.embed-section .section-head {
            display: none !important;
        }
        body.embed-mode .card.embed-active {
            border-radius: 0;
            border: 0;
            box-shadow: none;
            min-height: 100vh;
        }

        @media (max-width: 1300px) {
            .kpi-grid {
                grid-template-columns: repeat(4, minmax(140px, 1fr));
            }
            .category-grid {
                grid-template-columns: repeat(2, minmax(150px, 1fr));
            }
            .filter-bar {
                grid-template-columns: repeat(3, minmax(130px, 1fr));
            }
            .section-grid {
                grid-template-columns: 1fr;
            }
            .data-footer-grid {
                grid-template-columns: 1fr;
            }
            .span-8, .span-6, .span-4 {
                grid-column: span 12;
            }
        }

        @media (max-width: 860px) {
            body { padding: 10px; }
            .header { padding: 18px; }
            .filter-bar {
                position: static;
                grid-template-columns: repeat(2, minmax(120px, 1fr));
            }
            .kpi-grid {
                grid-template-columns: repeat(2, minmax(120px, 1fr));
            }
            .hero-topline {
                grid-template-columns: 1fr;
            }
            .section-nav {
                position: static;
            }
            .category-grid {
                grid-template-columns: 1fr;
            }
            .mini-bar {
                grid-template-columns: 120px 1fr 60px;
            }
            .action-card {
                grid-template-columns: 1fr;
            }
            .data-quality {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <header class="header">
            <div class="header-top">
                <div class="header-nav">
                    <a class="back-link nav-link" href="visualization.html">–ü—Ä–æ—Ü–µ—Å—Å Discovery</a>
                    <a class="back-link nav-link" href="hypothesis-digest.html">–î–∞–π–¥–∂–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑</a>
                    <a class="back-link nav-link" href="executive-dashboard.html">–î–∞–π–¥–∂–µ—Å—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ Discovery</a>
                </div>
                <div class="audience-pill">–ê—É–¥–∏—Ç–æ—Ä–∏—è: CEO ‚Ä¢ CPO ‚Ä¢ CTO ‚Ä¢ CIO ‚Ä¢ CFO ‚Ä¢ COO</div>
            </div>
            <h1>–î–∞–π–¥–∂–µ—Å—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ Discovery</h1>
            <div class="action-title" id="actionTitle"></div>
        </header>

        <section class="filter-bar">
            <div class="filter-item">
                <label for="periodFilter">–ü–µ—Ä–∏–æ–¥</label>
                <select id="periodFilter">
                    <option value="QTD">QTD (–∫–≤–∞—Ä—Ç–∞–ª –∫ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ)</option>
                    <option value="YTD">YTD (–≥–æ–¥ –∫ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ)</option>
                    <option value="L6M">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="categoryFilter">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
                <select id="categoryFilter">
                    <option value="all">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</option>
                    <option value="growth">–†–æ—Å—Ç</option>
                    <option value="value">–¶–µ–Ω–Ω–æ—Å—Ç—å</option>
                    <option value="retention">–£–¥–µ—Ä–∂–∞–Ω–∏–µ</option>
                    <option value="efficiency">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="teamFilter">–ö–æ–º–∞–Ω–¥–∞</label>
                <select id="teamFilter">
                    <option value="all">–í—Å–µ –∫–æ–º–∞–Ω–¥—ã</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="statusFilter">–°—Ç–∞—Ç—É—Å</label>
                <select id="statusFilter">
                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="formulated">–°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∞</option>
                    <option value="prioritized">–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞</option>
                    <option value="testing">–í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ</option>
                    <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</option>
                    <option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>
                    <option value="implemented">–í–Ω–µ–¥—Ä–µ–Ω–∞</option>
                </select>
            </div>
            <div class="filter-item">
                <label for="benchmarkMode">–≠—Ç–∞–ø –∑—Ä–µ–ª–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã</label>
                <select id="benchmarkMode">
                    <option value="initial">–ù–∞—á–∞–ª—å–Ω—ã–π</option>
                    <option value="developing" selected>–†–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è</option>
                    <option value="effective">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π</option>
                </select>
            </div>
        </section>

        <section class="category-disclaimer">
            <h3>–ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –¥–∞—à–±–æ—Ä–¥–µ</h3>
            <p>–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ —Å—á–∏—Ç—ã–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏: –∫–∞–∂–¥–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Ä–∞–∑–Ω–æ–º—É —Ç–∏–ø—É –±–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç–∞, –ø–æ—ç—Ç–æ–º—É –∏ –ø–æ—Ä–æ–≥–∏ –∑–∞—Ç—Ä–∞—Ç –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è.</p>
            <div class="category-grid">
                <div class="category-item">
                    <strong>–†–æ—Å—Ç</strong>
                    <span>–ì–∏–ø–æ—Ç–µ–∑—ã –ø—Ä–æ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –≤–æ—Ä–æ–Ω–∫–∏.</span>
                </div>
                <div class="category-item">
                    <strong>–¶–µ–Ω–Ω–æ—Å—Ç—å</strong>
                    <span>–ì–∏–ø–æ—Ç–µ–∑—ã –ø—Ä–æ –≤—ã—Ä—É—á–∫—É, –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—é, ARPU/LTV –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.</span>
                </div>
                <div class="category-item">
                    <strong>–£–¥–µ—Ä–∂–∞–Ω–∏–µ</strong>
                    <span>–ì–∏–ø–æ—Ç–µ–∑—ã –ø—Ä–æ —Å–Ω–∏–∂–µ–Ω–∏–µ –æ—Ç—Ç–æ–∫–∞, —Ä–æ—Å—Ç —á–∞—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–µ—Å—Å–∏–∏.</span>
                </div>
                <div class="category-item">
                    <strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</strong>
                    <span>–ì–∏–ø–æ—Ç–µ–∑—ã –ø—Ä–æ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–æ–º–∞–Ω–¥—ã.</span>
                </div>
            </div>
        </section>

        <section class="hero-summary">
            <div class="hero-topline">
                <article class="hero-kpi-card" id="heroCostCard">
                    <h3>–ó–∞—Ç—Ä–∞—Ç—ã</h3>
                    <div class="hero-kpi-value" id="heroCostValue">‚Äî</div>
                    <div class="hero-kpi-state" id="heroCostState">‚Äî</div>
                </article>
                <article class="hero-kpi-card" id="heroSpeedCard">
                    <h3>–°–∫–æ—Ä–æ—Å—Ç—å</h3>
                    <div class="hero-kpi-value" id="heroSpeedValue">‚Äî</div>
                    <div class="hero-kpi-state" id="heroSpeedState">‚Äî</div>
                </article>
                <article class="hero-kpi-card" id="heroQualityCard">
                    <h3>–ö–∞—á–µ—Å—Ç–≤–æ</h3>
                    <div class="hero-kpi-value" id="heroQualityValue">‚Äî</div>
                    <div class="hero-kpi-state" id="heroQualityState">‚Äî</div>
                </article>
            </div>
            <div class="hero-insight" id="heroInsight">–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –£–¥–µ—Ä–∂–∞–Ω–∏–µ.</div>
        </section>

        <section class="kpi-grid" id="kpiGrid"></section>

        <nav class="section-nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º">
            <a class="section-link" href="#section-actions">–î–µ–π—Å—Ç–≤–∏—è</a>
            <a class="section-link" href="#section-finance">–§–∏–Ω–∞–Ω—Å—ã</a>
            <a class="section-link" href="#section-operations">–û–ø–µ—Ä–∞—Ü–∏–∏</a>
            <a class="section-link" href="#section-strategy">–ü–æ—Ä—Ç—Ñ–µ–ª—å</a>
            <a class="section-link" href="#section-data">–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö</a>
        </nav>

        <section class="dashboard-section" id="section-actions">
            <div class="section-head">
                <h2>üéØ Actionable recommendations</h2>
                <p>–°–ø–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–µ—Ç—Ä–∏–∫–µ –∏ —Å—Ç–∞—Ç—É—Å–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</p>
            </div>
            <div class="action-card-list" id="actionCardList"></div>
        </section>

        <section class="dashboard-section" id="section-finance">
            <div class="section-head">
                <h2>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                <p id="financialContext">–ò–∑ ‚ÇΩ5.17M –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–∏–±–æ–ª—å—à–∞—è –¥–æ–ª—è –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø—ã ¬´–î–∞–Ω–Ω—ã–µ¬ª –∏ ¬´–î–µ–π—Å—Ç–≤–∏–µ¬ª.</p>
            </div>
            <div class="section-grid">
                <article class="card section-card" id="widget-cost-structure" data-widget="cost-structure">
                    <div class="section-label">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    <h2 id="financialTitle">–ó–∞—Ç—Ä–∞—Ç—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —Ñ–∞–∑–∞–º Discovery —Å –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π</h2>
                    <p class="subtitle">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞—Ç—Ä–∞—Ç –ø–æ —Ñ–∞–∑–∞–º –ø—Ä–æ–≤–µ—Ä–∫–∏: –ø—Ä—è–º—ã–µ –∏ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.</p>
                    <div class="chart-wrap tall"><canvas id="costWaterfall"></canvas></div>
                </article>

                <article class="card section-card" id="widget-cost" data-widget="cost">
                    <div class="section-label">–ö–æ–Ω—Ç—Ä–æ–ª—å –±—é–¥–∂–µ—Ç–∞</div>
                    <h2 id="costPerValidatedTitle">–ë–ª–æ–∫ –æ—Ç–≤–µ—Ç–∞: –≥–¥–µ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ</h2>
                    <p class="subtitle">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º: —Ñ–∞–∫—Ç, –ø–æ—Ä–æ–≥ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ.</p>
                    <div class="inline-alerts" id="financeInlineAlerts"></div>
                    <div class="chart-wrap"><canvas id="costPerValidatedChart"></canvas></div>
                    <div class="cost-readout" id="costPerValidatedReadout"></div>
                </article>
            </div>
        </section>

        <section class="dashboard-section" id="section-operations">
            <div class="section-head">
                <h2>‚öôÔ∏è –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞</h2>
                <p>–°–∫–æ—Ä–æ—Å—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π, bottleneck-–∞–Ω–∞–ª–∏–∑ –∏ –≤–æ—Ä–æ–Ω–∫–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤ –≤ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç—É—Ä–µ –ø—Ä–æ—Ü–µ—Å—Å–∞.</p>
            </div>
            <div class="section-grid">
                <article class="card section-card" id="widget-throughput" data-widget="throughput">
                    <div class="section-label">–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞</div>
                    <h2 id="throughputTitle">–¢–µ–º–ø –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å—Ç–∞–±–∏–ª–µ–Ω, –Ω–æ –Ω–∏–∂–µ –ø–ª–∞–Ω–æ–≤–æ–≥–æ –≤ –¥–≤—É—Ö –Ω–µ–¥–µ–ª—è—Ö</h2>
                    <p class="subtitle">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫: –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã.</p>
                    <div class="chart-wrap"><canvas id="throughputChart"></canvas></div>
                </article>

                <article class="card section-card" id="widget-cycle" data-widget="cycle">
                    <div class="section-label">–°–∫–æ—Ä–æ—Å—Ç—å —Ü–∏–∫–ª–∞</div>
                    <h2 id="cycleTitle">–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ–º –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
                    <p class="subtitle">–ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ + –≤–∫–ª–∞–¥ –æ–∂–∏–¥–∞–Ω–∏–π.</p>
                    <div class="chart-wrap"><canvas id="cycleTimeChart"></canvas></div>
                    <div class="mini-bars" id="waitingBars"></div>
                    <div class="bottleneck-line" id="bottleneckLine">Bottleneck: 1.4 –¥–Ω. ‚Üí 2.1 –¥–Ω. ‚Üí 1.2 –¥–Ω.</div>
                </article>
            </div>
            <article class="card section-card" id="widget-funnel" data-widget="funnel" style="margin-top:12px;">
                <div class="section-label">–í–æ—Ä–æ–Ω–∫–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤</div>
                <h2 id="funnelTitle">–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –≥–∏–ø–æ—Ç–µ–∑ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è</h2>
                <p class="subtitle">–°–≤—è–∑—å —Å timeline –ø—Ä–æ—Ü–µ—Å—Å–∞: —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ ‚Üí –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ‚Üí —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ ‚Üí –≤–Ω–µ–¥—Ä–µ–Ω–æ.</p>
                <div class="chart-wrap"><canvas id="funnelChart"></canvas></div>
            </article>
        </section>

        <section class="dashboard-section" id="section-strategy">
            <div class="section-head">
                <h2>üß≠ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å</h2>
                <p>–ú–∞—Ç—Ä–∏—Ü–∞ 2x2 —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–æ hover –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º.</p>
                <div class="chip-filter" id="strategicCategoryFilters">
                    <button class="chip-btn active" data-category="all">–í—Å–µ</button>
                    <button class="chip-btn" data-category="growth">–†–æ—Å—Ç</button>
                    <button class="chip-btn" data-category="value">–¶–µ–Ω–Ω–æ—Å—Ç—å</button>
                    <button class="chip-btn" data-category="retention">–£–¥–µ—Ä–∂–∞–Ω–∏–µ</button>
                    <button class="chip-btn" data-category="efficiency">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                </div>
            </div>
            <article class="card section-card" id="widget-matrix" data-widget="matrix">
                <div class="section-label">–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è</div>
                <h2 id="matrixTitle">–ü–æ—Ä—Ç—Ñ–µ–ª—å —Å–º–µ—â—ë–Ω –≤ –≤—ã—Å–æ–∫–æ–µ effort –ø–æ–ª–µ; quick wins –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç, –Ω–æ –Ω–µ–¥–æ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã</h2>
                <p class="subtitle">–ú–∞—Ç—Ä–∏—Ü–∞ 2x2: —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å vs —Å–ª–æ–∂–Ω–æ—Å—Ç—å, —Ä–∞–∑–º–µ—Ä —Ç–æ—á–∫–∏ = –æ—Ö–≤–∞—Ç, —Ü–≤–µ—Ç = —Å—Ç–∞—Ç—É—Å.</p>
                <div class="chart-wrap"><canvas id="matrixChart"></canvas></div>
                <div class="legend-row">
                    <span><span class="dot" style="background:#2e7d32;"></span>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ / –≤–Ω–µ–¥—Ä–µ–Ω–æ</span>
                    <span><span class="dot" style="background:#ff6b6b;"></span>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                    <span><span class="dot" style="background:#147bbc;"></span>–í —Ä–∞–±–æ—Ç–µ</span>
                </div>
            </article>
        </section>

        <section class="data-footer" id="section-data">
            <div class="data-footer-grid">
                <div class="data-footer-block">
                    <h3>–ü–æ—Ä–æ–≥–∏ –∏ —Å–∏–≥–Ω–∞–ª—ã</h3>
                    <div class="footer-thresholds" id="thresholdFooterGrid"></div>
                </div>
                <div class="data-footer-block">
                    <h3>–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <div class="data-quality" id="qualityGrid"></div>
                </div>
            </div>
            <div class="footer-note">
                <span><strong>–ü–æ—Ä–æ–≥ –∞–ª–µ—Ä—Ç–æ–≤:</strong> –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –±—é–¥–∂–µ—Ç–∞ &gt; 10%, —É—Ö—É–¥—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ &gt; 20%, –¥–æ–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∏–∂–µ —Ü–µ–ª–∏</span>
                <span id="lastUpdated">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî</span>
            </div>
        </section>
    </div>

    <script>
        const hypothesisData = [
            { id: "H-001", title: "–ù–æ–≤—ã–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º", category: "growth", product: "Core Web", team: "Alpha", status: "implemented", confidence: 89, effort: 2, reach: 82, costDirect: 182000, costIndirect: 74000, createdAt: "2026-01-05", prioritizedAt: "2026-01-07", researchStart: "2026-01-08", researchEnd: "2026-01-13", decisionAt: "2026-01-15" },
            { id: "H-002", title: "–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ checkout", category: "value", product: "Payments", team: "Gamma", status: "confirmed", confidence: 84, effort: 3, reach: 74, costDirect: 164000, costIndirect: 69000, createdAt: "2026-01-06", prioritizedAt: "2026-01-08", researchStart: "2026-01-10", researchEnd: "2026-01-16", decisionAt: "2026-01-18" },
            { id: "H-003", title: "–ü–∞–∫–µ—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ annual", category: "value", product: "Pricing", team: "Delta", status: "rejected", confidence: 63, effort: 4, reach: 91, costDirect: 228000, costIndirect: 84000, createdAt: "2026-01-09", prioritizedAt: "2026-01-11", researchStart: "2026-01-13", researchEnd: "2026-01-22", decisionAt: "2026-01-24" },
            { id: "H-004", title: "–£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø–æ—Ç–æ–∫–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è", category: "retention", product: "CRM", team: "Beta", status: "confirmed", confidence: 78, effort: 2, reach: 68, costDirect: 144000, costIndirect: 56000, createdAt: "2026-01-11", prioritizedAt: "2026-01-13", researchStart: "2026-01-15", researchEnd: "2026-01-20", decisionAt: "2026-01-23" },
            { id: "H-005", title: "–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∏—Å–∫–∞ –æ—Ç—Ç–æ–∫–∞", category: "retention", product: "ML", team: "Beta", status: "testing", confidence: 71, effort: 4, reach: 77, costDirect: 210000, costIndirect: 93000, createdAt: "2026-01-12", prioritizedAt: "2026-01-15", researchStart: "2026-01-18", researchEnd: null, decisionAt: null },
            { id: "H-006", title: "–ê–≤—Ç–æ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏", category: "efficiency", product: "Ops", team: "Omega", status: "implemented", confidence: 86, effort: 3, reach: 63, costDirect: 156000, costIndirect: 62000, createdAt: "2026-01-14", prioritizedAt: "2026-01-17", researchStart: "2026-01-20", researchEnd: "2026-01-27", decisionAt: "2026-01-29" },
            { id: "H-007", title: "–ü–æ—à–∞–≥–æ–≤—ã–π –ø–æ–∏—Å–∫ –Ω–∞ –ø–µ—Ä–≤–æ–π —Å–µ—Å—Å–∏–∏", category: "growth", product: "Core Web", team: "Alpha", status: "confirmed", confidence: 81, effort: 2, reach: 72, costDirect: 138000, costIndirect: 54000, createdAt: "2026-01-17", prioritizedAt: "2026-01-19", researchStart: "2026-01-22", researchEnd: "2026-01-28", decisionAt: "2026-01-31" },
            { id: "H-008", title: "–õ—ë–≥–∫–∞—è –≤–µ—Ä—Å–∏—è –æ—Ç—á—ë—Ç–æ–≤", category: "efficiency", product: "Reporting", team: "Omega", status: "rejected", confidence: 58, effort: 4, reach: 57, costDirect: 172000, costIndirect: 78000, createdAt: "2026-01-18", prioritizedAt: "2026-01-21", researchStart: "2026-01-24", researchEnd: "2026-02-01", decisionAt: "2026-02-04" },
            { id: "H-009", title: "–ü–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–Ω—Å–∞–π—Ç–∞", category: "value", product: "Monetization", team: "Delta", status: "confirmed", confidence: 82, effort: 3, reach: 85, costDirect: 188000, costIndirect: 82000, createdAt: "2026-01-20", prioritizedAt: "2026-01-23", researchStart: "2026-01-25", researchEnd: "2026-02-02", decisionAt: "2026-02-06" },
            { id: "H-010", title: "–ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂", category: "growth", product: "CRM", team: "Beta", status: "prioritized", confidence: 67, effort: 5, reach: 79, costDirect: 92000, costIndirect: 48000, createdAt: "2026-01-23", prioritizedAt: "2026-02-01", researchStart: null, researchEnd: null, decisionAt: null },
            { id: "H-011", title: "–ü–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –º–æ–¥—É–ª–µ –æ–ø–ª–∞—Ç—ã", category: "value", product: "Payments", team: "Gamma", status: "implemented", confidence: 88, effort: 2, reach: 76, costDirect: 132000, costIndirect: 49000, createdAt: "2026-01-25", prioritizedAt: "2026-01-28", researchStart: "2026-01-30", researchEnd: "2026-02-05", decisionAt: "2026-02-08" },
            { id: "H-012", title: "–ü–∏—Å—å–º–æ —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ + –æ—Ñ—Ñ–µ—Ä", category: "retention", product: "CRM", team: "Beta", status: "rejected", confidence: 54, effort: 3, reach: 66, costDirect: 146000, costIndirect: 58000, createdAt: "2026-01-27", prioritizedAt: "2026-01-30", researchStart: "2026-02-02", researchEnd: "2026-02-10", decisionAt: "2026-02-12" },
            { id: "H-013", title: "–®–∞–±–ª–æ–Ω—ã –¥–ª—è discovery briefs", category: "efficiency", product: "Ops", team: "Omega", status: "confirmed", confidence: 79, effort: 1, reach: 41, costDirect: 86000, costIndirect: 36000, createdAt: "2026-02-01", prioritizedAt: "2026-02-03", researchStart: "2026-02-04", researchEnd: "2026-02-08", decisionAt: "2026-02-09" },
            { id: "H-014", title: "–£–º–Ω—ã–π fallback –¥–ª—è API latency", category: "retention", product: "Platform", team: "Sigma", status: "testing", confidence: 69, effort: 5, reach: 83, costDirect: 236000, costIndirect: 108000, createdAt: "2026-02-02", prioritizedAt: "2026-02-05", researchStart: "2026-02-07", researchEnd: null, decisionAt: null },
            { id: "H-015", title: "–ò–º–ø–æ—Ä—Ç –∏–∑ Excel –≤ –æ–¥–∏–Ω –∫–ª–∏–∫", category: "growth", product: "Core Web", team: "Alpha", status: "confirmed", confidence: 80, effort: 3, reach: 71, costDirect: 149000, costIndirect: 62000, createdAt: "2026-02-04", prioritizedAt: "2026-02-06", researchStart: "2026-02-08", researchEnd: "2026-02-14", decisionAt: "2026-02-17" },
            { id: "H-016", title: "–ù–æ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º—ã", category: "value", product: "Payments", team: "Gamma", status: "implemented", confidence: 90, effort: 2, reach: 70, costDirect: 121000, costIndirect: 46000, createdAt: "2026-02-06", prioritizedAt: "2026-02-08", researchStart: "2026-02-10", researchEnd: "2026-02-14", decisionAt: "2026-02-16" },
            { id: "H-017", title: "–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏", category: "growth", product: "AI Assist", team: "Sigma", status: "testing", confidence: 73, effort: 5, reach: 94, costDirect: 264000, costIndirect: 116000, createdAt: "2026-02-08", prioritizedAt: "2026-02-11", researchStart: "2026-02-13", researchEnd: null, decisionAt: null },
            { id: "H-018", title: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–∏–Ω–≥ —Ç–∏–∫–µ—Ç–æ–≤", category: "efficiency", product: "Ops", team: "Omega", status: "confirmed", confidence: 82, effort: 3, reach: 59, costDirect: 138000, costIndirect: 55000, createdAt: "2026-02-09", prioritizedAt: "2026-02-12", researchStart: "2026-02-14", researchEnd: "2026-02-21", decisionAt: "2026-02-23" },
            { id: "H-019", title: "–ü–∞–∫–µ—Ç –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞", category: "value", product: "Monetization", team: "Delta", status: "formulated", confidence: 61, effort: 5, reach: 88, costDirect: 54000, costIndirect: 28000, createdAt: "2026-02-11", prioritizedAt: null, researchStart: null, researchEnd: null, decisionAt: null },
            { id: "H-020", title: "–£–º–Ω—ã–µ SLA-–æ–ø–æ–≤–µ—â–µ–Ω–∏—è", category: "retention", product: "Platform", team: "Sigma", status: "confirmed", confidence: 79, effort: 3, reach: 67, costDirect: 167000, costIndirect: 72000, createdAt: "2026-02-13", prioritizedAt: "2026-02-16", researchStart: "2026-02-18", researchEnd: "2026-02-24", decisionAt: "2026-02-26" },
            { id: "H-021", title: "–ü—Ä–æ–º–æ-–ª–µ–Ω–¥–∏–Ω–≥ —Å ROI-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º", category: "growth", product: "Core Web", team: "Alpha", status: "rejected", confidence: 57, effort: 2, reach: 64, costDirect: 101000, costIndirect: 43000, createdAt: "2026-02-14", prioritizedAt: "2026-02-17", researchStart: "2026-02-19", researchEnd: "2026-02-24", decisionAt: "2026-02-26" },
            { id: "H-022", title: "–°–Ω–∏–∂–µ–Ω–∏–µ —à—É–º–∞ –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ", category: "efficiency", product: "Platform", team: "Sigma", status: "prioritized", confidence: 66, effort: 4, reach: 62, costDirect: 98000, costIndirect: 47000, createdAt: "2026-02-16", prioritizedAt: "2026-02-19", researchStart: null, researchEnd: null, decisionAt: null },
            { id: "H-023", title: "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞", category: "value", product: "Pricing", team: "Delta", status: "testing", confidence: 75, effort: 4, reach: 87, costDirect: 216000, costIndirect: 94000, createdAt: "2026-02-18", prioritizedAt: "2026-02-21", researchStart: "2026-02-23", researchEnd: null, decisionAt: null },
            { id: "H-024", title: "–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–æ—É—á–∏–Ω–≥ –¥–ª—è –Ω–æ–≤—ã—Ö PM", category: "retention", product: "Core Web", team: "Beta", status: "confirmed", confidence: 83, effort: 2, reach: 55, costDirect: 112000, costIndirect: 42000, createdAt: "2026-02-19", prioritizedAt: "2026-02-21", researchStart: "2026-02-22", researchEnd: "2026-02-25", decisionAt: "2026-02-26" }
        ];

        const charts = {};
        const maturityTargets = {
            initial: {
                label: "–ù–∞—á–∞–ª—å–Ω—ã–π",
                total: 4700000,
                successRate: 0.28,
                researchDays: 11,
                experimentDays: 13,
                validationDays: 16,
                minResearchCount: 8,
                minExperimentCount: 6,
                costPerValidated: 620000
            },
            developing: {
                label: "–†–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è",
                total: 4300000,
                successRate: 0.36,
                researchDays: 8,
                experimentDays: 9,
                validationDays: 11,
                minResearchCount: 12,
                minExperimentCount: 10,
                costPerValidated: 480000
            },
            effective: {
                label: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π",
                total: 3900000,
                successRate: 0.45,
                researchDays: 5,
                experimentDays: 6,
                validationDays: 8,
                minResearchCount: 16,
                minExperimentCount: 14,
                costPerValidated: 360000
            }
        };

        const categoryLabels = {
            growth: "–†–æ—Å—Ç",
            value: "–¶–µ–Ω–Ω–æ—Å—Ç—å",
            retention: "–£–¥–µ—Ä–∂–∞–Ω–∏–µ",
            efficiency: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
        };
        const categoryDescriptions = {
            growth: "–ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
            value: "–º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –∏ —Ä–æ—Å—Ç –±–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç–∏",
            retention: "—É–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –æ—Ç—Ç–æ–∫–∞",
            efficiency: "—Å–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
        };

        const statusDecided = ["confirmed", "rejected", "implemented"];
        const statusPositive = ["confirmed", "implemented"];

        function parseDate(dateString) {
            return dateString ? new Date(dateString + "T00:00:00") : null;
        }

        function formatCurrency(value) {
            if (!Number.isFinite(value)) return "‚Äî";
            if (Math.abs(value) >= 1000000) return "‚ÇΩ" + (value / 1000000).toFixed(2) + "M";
            if (Math.abs(value) >= 1000) return "‚ÇΩ" + (value / 1000).toFixed(0) + "K";
            return "‚ÇΩ" + value.toFixed(0);
        }

        function formatNumber(value) {
            if (!Number.isFinite(value)) return "‚Äî";
            return value.toLocaleString("ru-RU");
        }

        function formatPct(value) {
            if (!Number.isFinite(value)) return "‚Äî";
            return (value * 100).toFixed(1) + "%";
        }

        function formatDays(value) {
            if (!Number.isFinite(value)) return "‚Äî";
            return value.toFixed(1) + " –¥–Ω.";
        }

        function getCategoryLabel(key) {
            return categoryLabels[key] || key;
        }

        function getCategoryDescription(key) {
            return categoryDescriptions[key] || "–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è";
        }

        function evaluateThreshold(value, target, mode) {
            if (!Number.isFinite(value) || !Number.isFinite(target)) {
                return { className: "warn", text: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö" };
            }
            const ok = mode === "max" ? value <= target : value >= target;
            return {
                className: ok ? "ok" : "warn",
                text: ok ? "–í –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ—Ä–æ–≥–∞" : "–¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è"
            };
        }

        function toDayDiff(start, end) {
            if (!start || !end) return null;
            const diff = (end - start) / (1000 * 60 * 60 * 24);
            return diff >= 0 ? diff : null;
        }

        function getQuarterStart(date) {
            const month = date.getMonth();
            const quarterStart = month - (month % 3);
            return new Date(date.getFullYear(), quarterStart, 1);
        }

        function getPeriodRange(periodKey) {
            const now = new Date();
            let start;
            if (periodKey === "YTD") {
                start = new Date(now.getFullYear(), 0, 1);
            } else if (periodKey === "L6M") {
                start = new Date(now.getFullYear(), now.getMonth() - 5, 1);
            } else {
                start = getQuarterStart(now);
            }
            return { start, end: now };
        }

        function getPreviousRange(currentRange) {
            const duration = currentRange.end.getTime() - currentRange.start.getTime();
            const prevEnd = new Date(currentRange.start.getTime() - 1);
            const prevStart = new Date(prevEnd.getTime() - duration);
            return { start: prevStart, end: prevEnd };
        }

        function isInRange(date, range) {
            if (!date) return false;
            return date >= range.start && date <= range.end;
        }

        function intersectsRange(record, range) {
            const points = [record.createdAt, record.prioritizedAt, record.researchStart, record.researchEnd, record.decisionAt].map(parseDate);
            return points.some(date => isInRange(date, range));
        }

        function median(values) {
            const filtered = values.filter(v => Number.isFinite(v)).sort((a, b) => a - b);
            if (!filtered.length) return null;
            const mid = Math.floor(filtered.length / 2);
            if (filtered.length % 2 === 0) return (filtered[mid - 1] + filtered[mid]) / 2;
            return filtered[mid];
        }

        function getWeeksBetween(start, end) {
            const diffDays = Math.max(1, (end - start) / (1000 * 60 * 60 * 24));
            return Math.max(1, diffDays / 7);
        }

        function fillTeamFilter() {
            const teamSelect = document.getElementById("teamFilter");
            const teams = Array.from(new Set(hypothesisData.map(item => item.team))).sort();
            teams.forEach(team => {
                const option = document.createElement("option");
                option.value = team;
                option.textContent = team;
                teamSelect.appendChild(option);
            });
        }

        function applyFilters(data, range, filters) {
            return data.filter(item => {
                if (filters.category !== "all" && item.category !== filters.category) return false;
                if (filters.team !== "all" && item.team !== filters.team) return false;
                if (filters.status !== "all" && item.status !== filters.status) return false;
                return intersectsRange(item, range);
            });
        }

        function computeMetrics(data, range, maturityKey) {
            const activeStatuses = ["prioritized", "testing", "confirmed", "rejected", "implemented"];
            const activeScope = data.filter(item => activeStatuses.includes(item.status));
            const totalCost = activeScope.reduce((sum, item) => sum + item.costDirect + item.costIndirect, 0);

            const researches = data.filter(item => isInRange(parseDate(item.researchEnd), range));
            const tested = data.filter(item => isInRange(parseDate(item.decisionAt), range) && statusDecided.includes(item.status));
            const confirmed = tested.filter(item => statusPositive.includes(item.status));

            const validationDays = tested.map(item => toDayDiff(parseDate(item.prioritizedAt), parseDate(item.decisionAt))).filter(v => Number.isFinite(v));
            const researchDays = researches.map(item => toDayDiff(parseDate(item.researchStart), parseDate(item.researchEnd))).filter(v => Number.isFinite(v));
            const experimentDays = tested.map(item => toDayDiff(parseDate(item.researchStart), parseDate(item.decisionAt))).filter(v => Number.isFinite(v));

            const weekCount = getWeeksBetween(range.start, range.end);
            const researchVelocity = researches.length / weekCount;
            const successRate = tested.length ? confirmed.length / tested.length : 0;
            const validationMedian = median(validationDays);
            const researchMedian = median(researchDays);
            const experimentMedian = median(experimentDays);
            const costPerValidated = confirmed.length ? totalCost / confirmed.length : null;

            const target = maturityTargets[maturityKey];
            const budgetGap = target.total ? (totalCost - target.total) / target.total : 0;
            const validationGap = target.validationDays && validationMedian ? (validationMedian - target.validationDays) / target.validationDays : 0;
            const successGap = target.successRate ? (successRate - target.successRate) / target.successRate : 0;

            return {
                totalCost,
                researchCount: researches.length,
                experimentCount: tested.length,
                confirmedCount: confirmed.length,
                testedCount: tested.length,
                successRate,
                researchVelocity,
                validationVelocityDays: validationMedian,
                researchVelocityDays: researchMedian,
                experimentVelocityDays: experimentMedian,
                costPerValidated,
                budgetGap,
                validationGap,
                successGap
            };
        }

        function computeDataQuality(data) {
            const total = data.length || 1;
            const missingDates = data.filter(item => !item.createdAt || !item.prioritizedAt).length;
            const missingCost = data.filter(item => !Number.isFinite(item.costDirect) || !Number.isFinite(item.costIndirect)).length;
            const duplicates = data.length - new Set(data.map(item => item.id)).size;
            return {
                missingDatesPct: missingDates / total,
                missingCostPct: missingCost / total,
                duplicatePct: duplicates / total
            };
        }

        function getDelta(current, previous, invertGood = false) {
            if (!Number.isFinite(current) || !Number.isFinite(previous) || previous === 0) {
                return { text: "–Ω/–¥", className: "delta-neutral" };
            }
            const delta = (current - previous) / previous;
            const sign = delta > 0 ? "+" : "";
            const label = sign + (delta * 100).toFixed(1) + "% –∫ –ø—Ä–æ—à–ª–æ–º—É –ø–µ—Ä–∏–æ–¥—É";
            const isGood = invertGood ? delta <= 0 : delta >= 0;
            return { text: label, className: isGood ? "delta-positive" : "delta-negative" };
        }

        function buildActionTitle(metrics, target) {
            const budgetSignal = metrics.budgetGap > 0.1 ? "–ø—Ä–µ–≤—ã—à–∞–µ—Ç –±—é–¥–∂–µ—Ç" : "–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –±—é–¥–∂–µ—Ç–Ω–æ–º –∫–æ—Ä–∏–¥–æ—Ä–µ";
            const experimentSignal = metrics.experimentVelocityDays && metrics.experimentVelocityDays <= target.experimentDays
                ? "—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —É–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ —Ü–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è"
                : "–≤—Ä–µ–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –≤—ã—à–µ —Ü–µ–ª–µ–≤–æ–≥–æ";
            const validationSignal = metrics.validationVelocityDays && metrics.validationVelocityDays <= target.validationDays
                ? "–ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑ —É—Å–∫–æ—Ä—è–µ—Ç—Å—è"
                : "–ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑ —Ç—Ä–µ–±—É–µ—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è";
            return "–ü–æ—Ä—Ç—Ñ–µ–ª—å –≥–∏–ø–æ—Ç–µ–∑ " + budgetSignal +
                ": TVC " + formatCurrency(metrics.totalCost) +
                ", –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ " + metrics.confirmedCount +
                " –∏–∑ " + metrics.testedCount +
                " —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤; " + experimentSignal +
                " (" + formatDays(metrics.experimentVelocityDays) + "), " +
                validationSignal + " (" + formatDays(metrics.validationVelocityDays) + ").";
        }

        function applyHeroStatus(cardId, valueId, stateId, valueText, stateText, statusClass) {
            const card = document.getElementById(cardId);
            const valueEl = document.getElementById(valueId);
            const stateEl = document.getElementById(stateId);
            if (!card || !valueEl || !stateEl) return;
            card.classList.remove("status-danger", "status-warn", "status-ok");
            card.classList.add(statusClass);
            valueEl.textContent = valueText;
            stateEl.textContent = stateText;
        }

        function renderHero(metrics, quality, target, costDiagnostics) {
            const costStatus = metrics.budgetGap > 0.1 ? "status-danger" : metrics.budgetGap > 0.03 ? "status-warn" : "status-ok";
            const speedGap = Number.isFinite(metrics.validationVelocityDays) && target.validationDays
                ? (metrics.validationVelocityDays - target.validationDays) / target.validationDays
                : null;
            const speedStatus = speedGap !== null && speedGap > 0.2 ? "status-danger" : speedGap !== null && speedGap > 0 ? "status-warn" : "status-ok";

            const qualityRisk = quality.missingDatesPct > 0.1 || quality.missingCostPct > 0.1 || quality.duplicatePct > 0;
            const qualityStatus = metrics.successRate < target.successRate ? (qualityRisk ? "status-danger" : "status-warn") : (qualityRisk ? "status-warn" : "status-ok");

            applyHeroStatus(
                "heroCostCard",
                "heroCostValue",
                "heroCostState",
                formatCurrency(metrics.totalCost),
                costStatus === "status-danger" ? "–¢—Ä–µ–≤–æ–≥–∞: –±—é–¥–∂–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω" : costStatus === "status-warn" ? "–†–∏—Å–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –±—é–¥–∂–µ—Ç–∞" : "–ù–æ—Ä–º–∞",
                costStatus
            );
            applyHeroStatus(
                "heroSpeedCard",
                "heroSpeedValue",
                "heroSpeedState",
                formatDays(metrics.validationVelocityDays),
                speedStatus === "status-danger" ? "–¢—Ä–µ–≤–æ–≥–∞: —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∏–∂–µ —Ü–µ–ª–∏" : speedStatus === "status-warn" ? "–ë–ª–∏–∑–∫–æ –∫ –ø–æ—Ä–æ–≥—É" : "–ù–æ—Ä–º–∞",
                speedStatus
            );
            applyHeroStatus(
                "heroQualityCard",
                "heroQualityValue",
                "heroQualityState",
                formatPct(metrics.successRate),
                qualityStatus === "status-danger" ? "–¢—Ä–µ–≤–æ–≥–∞: –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∏–∂–µ —Ü–µ–ª–∏" : qualityStatus === "status-warn" ? "–ó–æ–Ω–∞ –≤–Ω–∏–º–∞–Ω–∏—è" : "–ù–æ—Ä–º–∞",
                qualityStatus
            );

            const insightEl = document.getElementById("heroInsight");
            if (!insightEl) return;
            const overrun = costDiagnostics.filter(item => item.delta > 0).sort((a, b) => b.delta - a.delta);
            if (overrun.length) {
                const worst = overrun[0];
                insightEl.textContent = "–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ " + getCategoryLabel(worst.category) +
                    ": +" + formatCurrency(worst.delta) + " –∫ –ø–æ—Ä–æ–≥—É.";
            } else {
                insightEl.textContent = "–ö—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –Ω–µ—Ç: –±—é–¥–∂–µ—Ç–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è.";
            }
        }

        function renderKpis(currentMetrics, previousMetrics, target) {
            const grid = document.getElementById("kpiGrid");
            grid.innerHTML = "";

            const items = [
                {
                    label: "–û–±—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É",
                    value: formatCurrency(currentMetrics.totalCost),
                    delta: getDelta(currentMetrics.totalCost, previousMetrics.totalCost, true),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â§ " + formatCurrency(target.total),
                    threshold: evaluateThreshold(currentMetrics.totalCost, target.total, "max")
                },
                {
                    label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π",
                    value: formatNumber(currentMetrics.researchCount),
                    delta: getDelta(currentMetrics.researchCount, previousMetrics.researchCount, false),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â• " + formatNumber(target.minResearchCount),
                    threshold: evaluateThreshold(currentMetrics.researchCount, target.minResearchCount, "min")
                },
                {
                    label: "–í—Ä–µ–º—è –Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
                    value: formatDays(currentMetrics.researchVelocityDays),
                    delta: getDelta(currentMetrics.researchVelocityDays, previousMetrics.researchVelocityDays, true),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â§ " + formatDays(target.researchDays),
                    threshold: evaluateThreshold(currentMetrics.researchVelocityDays, target.researchDays, "max")
                },
                {
                    label: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤",
                    value: formatNumber(currentMetrics.experimentCount),
                    delta: getDelta(currentMetrics.experimentCount, previousMetrics.experimentCount, false),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â• " + formatNumber(target.minExperimentCount),
                    threshold: evaluateThreshold(currentMetrics.experimentCount, target.minExperimentCount, "min")
                },
                {
                    label: "–í—Ä–µ–º—è –Ω–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã",
                    value: formatDays(currentMetrics.experimentVelocityDays),
                    delta: getDelta(currentMetrics.experimentVelocityDays, previousMetrics.experimentVelocityDays, true),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â§ " + formatDays(target.experimentDays),
                    threshold: evaluateThreshold(currentMetrics.experimentVelocityDays, target.experimentDays, "max")
                },
                {
                    label: "–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑",
                    value: formatDays(currentMetrics.validationVelocityDays),
                    delta: getDelta(currentMetrics.validationVelocityDays, previousMetrics.validationVelocityDays, true),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â§ " + formatDays(target.validationDays),
                    threshold: evaluateThreshold(currentMetrics.validationVelocityDays, target.validationDays, "max")
                },
                {
                    label: "–î–æ–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≥–∏–ø–æ—Ç–µ–∑",
                    value: formatPct(currentMetrics.successRate),
                    delta: getDelta(currentMetrics.successRate, previousMetrics.successRate, false),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â• " + formatPct(target.successRate),
                    threshold: evaluateThreshold(currentMetrics.successRate, target.successRate, "min")
                },
                {
                    label: "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã",
                    value: formatCurrency(currentMetrics.costPerValidated),
                    delta: getDelta(currentMetrics.costPerValidated, previousMetrics.costPerValidated, true),
                    targetText: "–ü–æ—Ä–æ–≥: ‚â§ " + formatCurrency(target.costPerValidated),
                    threshold: evaluateThreshold(currentMetrics.costPerValidated, target.costPerValidated, "max")
                }
            ];

            items.forEach(item => {
                const card = document.createElement("article");
                card.className = "kpi-card";
                card.innerHTML = `
                    <div class="kpi-label">${item.label}</div>
                    <div class="kpi-value">${item.value}</div>
                    <div class="kpi-delta ${item.delta.className}">${item.delta.text}</div>
                    <div class="kpi-target">${item.targetText}</div>
                    <div class="kpi-state ${item.threshold.className}">${item.threshold.text}</div>
                `;
                grid.appendChild(card);
            });
        }

        function getPhaseCosts(data) {
            const mix = [
                { phase: "–ì–∏–ø–æ—Ç–µ–∑–∞", d: 0.17, i: 0.12 },
                { phase: "–î–µ–π—Å—Ç–≤–∏–µ", d: 0.26, i: 0.22 },
                { phase: "–î–∞–Ω–Ω—ã–µ", d: 0.33, i: 0.41 },
                { phase: "–ò–Ω—Å–∞–π—Ç—ã", d: 0.24, i: 0.25 }
            ];
            const totalDirect = data.reduce((sum, item) => sum + item.costDirect, 0);
            const totalIndirect = data.reduce((sum, item) => sum + item.costIndirect, 0);
            return mix.map(item => ({
                phase: item.phase,
                direct: Math.round(totalDirect * item.d),
                indirect: Math.round(totalIndirect * item.i)
            }));
        }

        function getCostPerValidatedByCategory(data) {
            const categories = ["growth", "value", "retention", "efficiency"];
            return categories.map(cat => {
                const scoped = data.filter(item => item.category === cat);
                const confirmed = scoped.filter(item => statusPositive.includes(item.status));
                const cost = scoped.reduce((sum, item) => sum + item.costDirect + item.costIndirect, 0);
                return {
                    category: cat,
                    value: confirmed.length ? cost / confirmed.length : 0
                };
            });
        }

        function getCostDiagnostics(data, maturityKey) {
            const target = maturityTargets[maturityKey].costPerValidated;
            return getCostPerValidatedByCategory(data)
                .map(item => ({
                    ...item,
                    target,
                    delta: item.value - target,
                    ratio: target > 0 ? (item.value - target) / target : 0
                }))
                .filter(item => item.value > 0);
        }

        function weekLabel(date) {
            const d = new Date(date);
            return `${d.getDate().toString().padStart(2, "0")}.${(d.getMonth() + 1).toString().padStart(2, "0")}`;
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay() || 7;
            d.setDate(d.getDate() - day + 1);
            d.setHours(0, 0, 0, 0);
            return d;
        }

        function buildWeeklySeries(data, range) {
            const start = getWeekStart(range.start);
            const points = [];
            const mapResearch = {};
            const mapTested = {};

            for (let i = 0; i < 16; i++) {
                const current = new Date(start);
                current.setDate(start.getDate() + i * 7);
                if (current > range.end) break;
                const key = current.toISOString().slice(0, 10);
                points.push({ key, label: weekLabel(current), research: 0, tested: 0 });
            }

            data.forEach(item => {
                const researchEnd = parseDate(item.researchEnd);
                const decision = parseDate(item.decisionAt);

                if (researchEnd && isInRange(researchEnd, range)) {
                    const key = getWeekStart(researchEnd).toISOString().slice(0, 10);
                    mapResearch[key] = (mapResearch[key] || 0) + 1;
                }
                if (decision && isInRange(decision, range) && statusDecided.includes(item.status)) {
                    const key = getWeekStart(decision).toISOString().slice(0, 10);
                    mapTested[key] = (mapTested[key] || 0) + 1;
                }
            });

            return points.map(point => ({
                label: point.label,
                research: mapResearch[point.key] || 0,
                tested: mapTested[point.key] || 0
            }));
        }

        function getFunnel(data) {
            return {
                formulated: data.filter(item => item.status === "formulated").length,
                prioritized: data.filter(item => ["prioritized", "testing", "confirmed", "rejected", "implemented"].includes(item.status)).length,
                testing: data.filter(item => item.status === "testing").length,
                confirmed: data.filter(item => statusPositive.includes(item.status)).length,
                rejected: data.filter(item => item.status === "rejected").length,
                implemented: data.filter(item => item.status === "implemented").length
            };
        }

        function colorByStatus(status) {
            if (status === "rejected") return "#ff6b6b";
            if (statusPositive.includes(status)) return "#2e7d32";
            return "#147bbc";
        }

        function destroyChart(name) {
            if (charts[name]) {
                charts[name].destroy();
                charts[name] = null;
            }
        }

        function renderFinancialCharts(filteredData, metrics, maturityKey, categoryFilter) {
            const phaseCosts = getPhaseCosts(filteredData);
            destroyChart("costWaterfall");
            charts.costWaterfall = new Chart(document.getElementById("costWaterfall"), {
                type: "bar",
                data: {
                    labels: phaseCosts.map(item => item.phase),
                    datasets: [
                        {
                            label: "–ü—Ä—è–º—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã",
                            data: phaseCosts.map(item => item.direct),
                            backgroundColor: "#0f4c75",
                            borderRadius: 5
                        },
                        {
                            label: "–ö–æ—Å–≤–µ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã",
                            data: phaseCosts.map(item => item.indirect),
                            backgroundColor: "#9dd4f2",
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: "bottom", labels: { boxWidth: 12, usePointStyle: true } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ": " + formatCurrency(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: {
                            stacked: true,
                            ticks: {
                                callback: function(value) { return formatCurrency(value); }
                            }
                        }
                    }
                }
            });

            const byCategory = getCostDiagnostics(filteredData, maturityKey);
            const target = maturityTargets[maturityKey].costPerValidated;
            const barColors = byCategory.map(item => item.delta > 0 ? "rgba(198,40,40,0.72)" : "rgba(46,125,50,0.72)");
            destroyChart("costPerValidatedChart");
            charts.costPerValidatedChart = new Chart(document.getElementById("costPerValidatedChart"), {
                data: {
                    labels: byCategory.map(item => getCategoryLabel(item.category)),
                    datasets: [
                        {
                            type: "bar",
                            label: "–§–∞–∫—Ç",
                            data: byCategory.map(item => Math.round(item.value)),
                            backgroundColor: barColors,
                            borderRadius: 5
                        },
                        {
                            type: "line",
                            label: "–ü–æ—Ä–æ–≥",
                            data: byCategory.map(() => target),
                            borderColor: "#ffb800",
                            pointRadius: 0,
                            borderDash: [5, 4],
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: "bottom", labels: { boxWidth: 12, usePointStyle: true } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ": " + formatCurrency(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y: { ticks: { callback: (value) => formatCurrency(value) } }
                    }
                }
            });

            const actionAndDataCost = phaseCosts
                .filter(item => item.phase === "–î–µ–π—Å—Ç–≤–∏–µ" || item.phase === "–î–∞–Ω–Ω—ã–µ")
                .reduce((sum, item) => sum + item.direct + item.indirect, 0);
            const actionAndDataShare = metrics.totalCost > 0 ? actionAndDataCost / metrics.totalCost : 0;

            document.getElementById("financialTitle").textContent =
                "–ò–∑ –æ–±—â–∏—Ö –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≥–∏–ø–æ—Ç–µ–∑ " + formatCurrency(metrics.totalCost) +
                " –Ω–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö —É—Ö–æ–¥–∏—Ç " + formatCurrency(actionAndDataCost) +
                " (" + formatPct(actionAndDataShare) + ").";
            document.getElementById("financialContext").textContent =
                "–ò–∑ " + formatCurrency(metrics.totalCost) + " –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —ç—Ç–∞–ø—ã ¬´–î–µ–π—Å—Ç–≤–∏–µ + –î–∞–Ω–Ω—ã–µ¬ª –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è " +
                formatCurrency(actionAndDataCost) + " (" + formatPct(actionAndDataShare) + ").";

            const readout = document.getElementById("costPerValidatedReadout");
            readout.innerHTML = "";
            const alertsEl = document.getElementById("financeInlineAlerts");
            alertsEl.innerHTML = "";
            const withValues = byCategory;

            if (!withValues.length || !Number.isFinite(metrics.costPerValidated)) {
                document.getElementById("costPerValidatedTitle").textContent =
                    "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö –≥–∏–ø–æ—Ç–µ–∑ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º.";

                const row = document.createElement("div");
                row.className = "cost-row";
                row.innerHTML = `
                    <div>
                        <div class="cost-main">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ñ–∏–ª—å—Ç—Ä—É</div>
                        <div class="cost-meta">–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã –∏–ª–∏ —Ä–∞—Å—à–∏—Ä—å—Ç–µ –ø–µ—Ä–∏–æ–¥.</div>
                    </div>
                    <div class="cost-status">‚Äî</div>
                `;
                readout.appendChild(row);
                return;
            }

            const overrun = withValues.filter(item => item.delta > 0);
            const sortedByDelta = [...withValues].sort((a, b) => b.delta - a.delta);
            const worst = sortedByDelta[0];

            if (overrun.length) {
                overrun.slice(0, 3).forEach(item => {
                    const alert = document.createElement("div");
                    alert.className = "inline-alert";
                    alert.textContent = "‚ö†Ô∏è " + getCategoryLabel(item.category) + ": +" + formatCurrency(item.delta) + " –∫ –ø–æ—Ä–æ–≥—É";
                    alertsEl.appendChild(alert);
                });
            } else {
                const alert = document.createElement("div");
                alert.className = "inline-alert ok";
                alert.textContent = "‚úì –í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ—Ä–æ–≥ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã";
                alertsEl.appendChild(alert);
            }

            if (overrun.length > 0) {
                document.getElementById("costPerValidatedTitle").textContent =
                    "–í –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–µ " + overrun.length + " –∏–∑ " + withValues.length +
                    " –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π; –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ ‚Äî " + getCategoryLabel(worst.category) +
                    " (+" + formatCurrency(worst.delta) + " –∫ –ø–æ—Ä–æ–≥—É).";
            } else {
                document.getElementById("costPerValidatedTitle").textContent =
                    "–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –Ω–µ—Ç: –≤—Å–µ " + withValues.length +
                    " –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —É–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ—Ä–æ–≥ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã.";
            }

            sortedByDelta.forEach(item => {
                const row = document.createElement("div");
                const isOverrun = item.delta > 0;
                const statusClass = isOverrun ? "over" : "ok";
                const deltaText = isOverrun
                    ? "–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥: +" + formatCurrency(item.delta) + " (" + formatPct(item.ratio) + ")"
                    : "–ù–∏–∂–µ –ø–æ—Ä–æ–≥–∞: " + formatCurrency(Math.abs(item.delta)) + " (" + formatPct(Math.abs(item.ratio)) + ")";

                row.className = "cost-row";
                row.classList.add("clickable");
                if (categoryFilter === item.category) {
                    row.classList.add("active");
                }
                row.innerHTML = `
                    <div>
                        <div class="cost-main">${getCategoryLabel(item.category)}: ${formatCurrency(item.value)}</div>
                        <div class="cost-meta">–ü–æ—Ä–æ–≥: ${formatCurrency(target)} ‚Ä¢ –§–æ–∫—É—Å: ${getCategoryDescription(item.category)}</div>
                    </div>
                    <div class="cost-status ${statusClass}">${deltaText}</div>
                `;
                row.addEventListener("click", () => {
                    const categorySelect = document.getElementById("categoryFilter");
                    if (!categorySelect) return;
                    categorySelect.value = item.category;
                    render();
                    const section = document.getElementById("section-finance");
                    if (section) section.scrollIntoView({ behavior: "smooth", block: "start" });
                });
                readout.appendChild(row);
            });
        }

        function renderOperationalCharts(filteredData, range, metrics, maturityKey) {
            const weekly = buildWeeklySeries(filteredData, range);
            destroyChart("throughputChart");
            charts.throughputChart = new Chart(document.getElementById("throughputChart"), {
                type: "line",
                data: {
                    labels: weekly.map(item => item.label),
                    datasets: [
                        {
                            label: "–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è",
                            data: weekly.map(item => item.research),
                            borderColor: "#147bbc",
                            backgroundColor: "rgba(20, 123, 188, 0.15)",
                            fill: true,
                            tension: 0.28,
                            pointRadius: 3
                        },
                        {
                            label: "–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã",
                            data: weekly.map(item => item.tested),
                            borderColor: "#00a9b5",
                            backgroundColor: "rgba(0, 169, 181, 0.1)",
                            fill: true,
                            tension: 0.28,
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: "bottom", labels: { boxWidth: 12, usePointStyle: true } } },
                    scales: {
                        x: { grid: { display: false } },
                        y: { beginAtZero: true, ticks: { precision: 0 } }
                    }
                }
            });

            const cycleData = [
                Math.round((metrics.researchVelocityDays || 0) * 10) / 10,
                Math.round((metrics.experimentVelocityDays || 0) * 10) / 10,
                Math.round((metrics.validationVelocityDays || 0) * 10) / 10
            ];
            const targetResearch = maturityTargets[maturityKey].researchDays;
            const targetExperiment = maturityTargets[maturityKey].experimentDays;
            const targetValidation = maturityTargets[maturityKey].validationDays;

            destroyChart("cycleTimeChart");
            charts.cycleTimeChart = new Chart(document.getElementById("cycleTimeChart"), {
                data: {
                    labels: ["–í—Ä–µ–º—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è", "–í—Ä–µ–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞", "–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑"],
                    datasets: [
                        {
                            type: "bar",
                            label: "–§–∞–∫—Ç, –¥–Ω–µ–π",
                            data: cycleData,
                            backgroundColor: ["#0f4c75", "#1e9fd9", "#00a9b5"],
                            borderRadius: 5
                        },
                        {
                            type: "line",
                            label: "–ü–æ—Ä–æ–≥, –¥–Ω–µ–π",
                            data: [targetResearch, targetExperiment, targetValidation],
                            borderColor: "#ffb800",
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: "#ffb800",
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: "bottom", labels: { boxWidth: 12, usePointStyle: true } } },
                    scales: {
                        x: { grid: { display: false } },
                        y: { beginAtZero: true }
                    }
                }
            });

            const waitingBreakdown = [
                { label: "–ú–µ–∂–¥—É –≥–∏–ø–æ—Ç–µ–∑–æ–π –∏ –¥–µ–π—Å—Ç–≤–∏–µ–º", value: 1.4 },
                { label: "–ú–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏–µ–º –∏ –¥–∞–Ω–Ω—ã–º–∏", value: 2.1 },
                { label: "–ú–µ–∂–¥—É –¥–∞–Ω–Ω—ã–º–∏ –∏ –∏–Ω—Å–∞–π—Ç–∞–º–∏", value: 1.2 }
            ];
            const maxValue = Math.max(...waitingBreakdown.map(item => item.value), 1);
            const waitingEl = document.getElementById("waitingBars");
            waitingEl.innerHTML = "";
            waitingBreakdown.forEach(item => {
                const percent = (item.value / maxValue) * 100;
                const row = document.createElement("div");
                row.className = "mini-bar";
                row.innerHTML = `
                    <span>${item.label}</span>
                    <div class="mini-track"><div class="mini-fill" style="width:${percent}%;"></div></div>
                    <strong>${item.value.toFixed(1)} –¥–Ω.</strong>
                `;
                waitingEl.appendChild(row);
            });
            const bottleneckEl = document.getElementById("bottleneckLine");
            if (bottleneckEl) {
                bottleneckEl.textContent =
                    "Bottleneck-–∞–Ω–∞–ª–∏–∑ (–¥–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è): 1.4–¥–Ω ‚Üí 2.1–¥–Ω ‚Üí 1.2–¥–Ω. –£–∑–∫–æ–µ –º–µ—Å—Ç–æ: –ø–µ—Ä–µ—Ö–æ–¥ ¬´–î–µ–π—Å—Ç–≤–∏–µ ‚Üí –î–∞–Ω–Ω—ã–µ¬ª.";
            }

            document.getElementById("throughputTitle").textContent =
                "–ü–æ—Ç–æ–∫ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å—Ç–∞–±–∏–ª–µ–Ω: –∑–∞–≤–µ—Ä—à–µ–Ω–æ " + metrics.researchCount +
                " –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ " + metrics.experimentCount + " —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.";
            document.getElementById("cycleTitle").textContent =
                "–í—Ä–µ–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑ –¥–æ–ª–∂–Ω–æ —Å–æ–∫—Ä–∞—â–∞—Ç—å—Å—è —Å —Ä–æ—Å—Ç–æ–º –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –∫–æ–º–∞–Ω–¥—ã; —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî " +
                formatDays(metrics.validationVelocityDays) + ".";
        }

        function renderOutcomeCharts(filteredData) {
            const funnel = getFunnel(filteredData);
            destroyChart("funnelChart");
            charts.funnelChart = new Chart(document.getElementById("funnelChart"), {
                type: "bar",
                data: {
                    labels: ["–°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–æ", "–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ", "–í —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ", "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ", "–û—Ç–∫–ª–æ–Ω–µ–Ω–æ", "–í–Ω–µ–¥—Ä–µ–Ω–æ"],
                    datasets: [
                        {
                            label: "–ì–∏–ø–æ—Ç–µ–∑—ã",
                            data: [funnel.formulated, funnel.prioritized, funnel.testing, funnel.confirmed, funnel.rejected, funnel.implemented],
                            backgroundColor: ["#9dd4f2", "#1e9fd9", "#147bbc", "#2e7d32", "#ff6b6b", "#0a2f4c"],
                            borderRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false } }, y: { beginAtZero: true, ticks: { precision: 0 } } }
                }
            });

            const points = filteredData.map(item => ({
                x: item.confidence,
                y: item.effort,
                r: Math.max(4, Math.round(item.reach / 12)),
                status: item.status,
                title: item.title,
                id: item.id,
                team: item.team,
                category: item.category,
                cost: item.costDirect + item.costIndirect
            }));

            destroyChart("matrixChart");
            charts.matrixChart = new Chart(document.getElementById("matrixChart"), {
                type: "bubble",
                data: {
                    datasets: [
                        {
                            label: "–ü–æ—Ä—Ç—Ñ–µ–ª—å –≥–∏–ø–æ—Ç–µ–∑",
                            data: points,
                            backgroundColor: points.map(point => colorByStatus(point.status)),
                            borderColor: "#ffffff",
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const p = context.raw;
                                    return `${p.id}: ${p.title} | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ${p.x}% | –°–ª–æ–∂–Ω–æ—Å—Ç—å ${p.y} | –ö–æ–º–∞–Ω–¥–∞ ${p.team} | ${getCategoryLabel(p.category)} | ${formatCurrency(p.cost)}`;
                                }
                            }
                        }
                    },
                    onHover: (event, elements) => {
                        event.native.target.style.cursor = elements.length ? "pointer" : "default";
                    },
                    scales: {
                        x: {
                            min: 40,
                            max: 95,
                            title: { display: true, text: "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, %" },
                            grid: { color: "#e9ecef" }
                        },
                        y: {
                            min: 1,
                            max: 5,
                            reverse: true,
                            title: { display: true, text: "–°–ª–æ–∂–Ω–æ—Å—Ç—å (1-5)" },
                            ticks: { stepSize: 1 },
                            grid: { color: "#e9ecef" }
                        }
                    }
                }
            });

            document.getElementById("funnelTitle").textContent =
                "–ò–∑ " + (funnel.prioritized + funnel.formulated) +
                " –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—à–ª–æ " + funnel.confirmed +
                ", –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è ‚Äî " + funnel.implemented + ".";
            document.getElementById("matrixTitle").textContent =
                "–ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ª—é –±—ã—Å—Ç—Ä—ã—Ö –ø–æ–±–µ–¥ –∏ –¥–æ—Ä–æ–≥–∏—Ö –≥–∏–ø–æ—Ç–µ–∑ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ.";
        }

        function renderActionCards(currentMetrics, quality, maturityKey, costDiagnostics) {
            const target = maturityTargets[maturityKey];
            const actionList = document.getElementById("actionCardList");
            actionList.innerHTML = "";

            const actions = [];
            const overrun = costDiagnostics.filter(item => item.delta > 0).sort((a, b) => b.delta - a.delta);
            if (overrun.length) {
                const worst = overrun[0];
                actions.push({
                    priority: "P1",
                    title: "–°–Ω–∏–∑–∏—Ç—å –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ ¬´" + getCategoryLabel(worst.category) + "¬ª",
                    text: "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ –Ω–∞ " + formatCurrency(worst.delta) + ". –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∏–∑–∞–π–Ω —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏.",
                    metric: "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –≥–∏–ø–æ—Ç–µ–∑—ã",
                    link: "#section-finance",
                    status: "new",
                    statusText: "–ù–æ–≤–∞—è"
                });
            } else {
                actions.push({
                    priority: "P3",
                    title: "–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –±—é–¥–∂–µ—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏",
                    text: "–ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –Ω–µ—Ç. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ü–µ–ª–µ–≤–æ–º –∫–æ—Ä–∏–¥–æ—Ä–µ.",
                    metric: "–ö–æ–Ω—Ç—Ä–æ–ª—å –±—é–¥–∂–µ—Ç–∞",
                    link: "#section-finance",
                    status: "done",
                    statusText: "–°—Ç–∞–±–∏–ª—å–Ω–æ"
                });
            }

            if (currentMetrics.validationVelocityDays && currentMetrics.validationVelocityDays > target.validationDays) {
                actions.push({
                    priority: "P1",
                    title: "–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑",
                    text: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ " + formatDays(currentMetrics.validationVelocityDays) + " –ø—Ä–æ—Ç–∏–≤ —Ü–µ–ª–µ–≤—ã—Ö " + formatDays(target.validationDays) + ".",
                    metric: "–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–∏–ø–æ—Ç–µ–∑",
                    link: "#section-operations",
                    status: "in-progress",
                    statusText: "–í —Ä–∞–±–æ—Ç–µ"
                });
            }

            if (currentMetrics.experimentVelocityDays && currentMetrics.experimentVelocityDays > target.experimentDays) {
                actions.push({
                    priority: "P2",
                    title: "–£–±—Ä–∞—Ç—å bottleneck –º–µ–∂–¥—É ¬´–î–µ–π—Å—Ç–≤–∏–µ¬ª –∏ ¬´–î–∞–Ω–Ω—ã–µ¬ª",
                    text: "–ö—Ä–∏—Ç–∏—á–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ —Ü–µ–ø–æ—á–∫–µ 1.4–¥–Ω ‚Üí 2.1–¥–Ω ‚Üí 1.2–¥–Ω. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å SLA –Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –≥–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.",
                    metric: "–í—Ä–µ–º—è –Ω–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã",
                    link: "#section-operations",
                    status: "in-progress",
                    statusText: "–í —Ä–∞–±–æ—Ç–µ"
                });
            }

            if (currentMetrics.successRate < target.successRate) {
                actions.push({
                    priority: "P2",
                    title: "–ü–æ–¥–Ω—è—Ç—å –¥–æ–ª—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≥–∏–ø–æ—Ç–µ–∑",
                    text: "Success rate " + formatPct(currentMetrics.successRate) + " –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ " + formatPct(target.successRate) + ". –£—Å–∏–ª–∏—Ç—å pre-check –≥–∏–ø–æ—Ç–µ–∑ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.",
                    metric: "–î–æ–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≥–∏–ø–æ—Ç–µ–∑",
                    link: "#section-strategy",
                    status: "new",
                    statusText: "–ù–æ–≤–∞—è"
                });
            }

            if (quality.missingDatesPct > 0.1 || quality.missingCostPct > 0.1 || quality.duplicatePct > 0) {
                actions.push({
                    priority: "P2",
                    title: "–£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
                    text: "–ï—Å—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏ –∏/–∏–ª–∏ –¥—É–±–ª–∏, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ KPI. –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞—á–∏—Å—Ç–∫–∞ tracker –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á—ë—Ç–∞.",
                    metric: "–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö",
                    link: "#section-data",
                    status: "new",
                    statusText: "–ù–æ–≤–∞—è"
                });
            }

            if (!actions.length) {
                actions.push({
                    priority: "P3",
                    title: "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Ç–º",
                    text: "–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ü–µ–ª–µ–≤–æ–º –∫–æ—Ä–∏–¥–æ—Ä–µ. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫ –Ω–∞ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.",
                    metric: "–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å",
                    link: "#section-finance",
                    status: "done",
                    statusText: "–°—Ç–∞–±–∏–ª—å–Ω–æ"
                });
            }

            const priorityRank = { P1: 1, P2: 2, P3: 3 };
            actions.sort((a, b) => priorityRank[a.priority] - priorityRank[b.priority]);

            actions.slice(0, 5).forEach(item => {
                const card = document.createElement("article");
                card.className = "action-card";
                card.innerHTML = `
                    <div class="priority-badge ${item.priority.toLowerCase()}">${item.priority}</div>
                    <div>
                        <div class="action-title">${item.title}</div>
                        <div class="action-text">${item.text}</div>
                        <div class="action-meta">
                            <span class="metric-badge">–ú–µ—Ç—Ä–∏–∫–∞: ${item.metric}</span>
                            <a class="metric-link" href="${item.link}">–ü–µ—Ä–µ–π—Ç–∏ –∫ –±–ª–æ–∫—É ‚Üó</a>
                        </div>
                    </div>
                    <div class="action-status ${item.status}">${item.statusText}</div>
                `;
                actionList.appendChild(card);
            });
        }

        function renderQuality(quality) {
            const qualityGrid = document.getElementById("qualityGrid");
            qualityGrid.innerHTML = "";
            const items = [
                { label: "–ü—Ä–æ–ø—É—Å–∫–∏ –¥–∞—Ç", value: formatPct(quality.missingDatesPct) },
                { label: "–ü—Ä–æ–ø—É—Å–∫–∏ –∑–∞—Ç—Ä–∞—Ç", value: formatPct(quality.missingCostPct) },
                { label: "–î—É–±–ª–∏ ID", value: formatPct(quality.duplicatePct) }
            ];
            items.forEach(item => {
                const el = document.createElement("div");
                el.className = "quality-box";
                el.innerHTML = `<strong>${item.value}</strong>${item.label}`;
                qualityGrid.appendChild(el);
            });
        }

        function renderFooterThresholds(metrics, target) {
            const thresholdGrid = document.getElementById("thresholdFooterGrid");
            thresholdGrid.innerHTML = "";

            const rows = [
                {
                    label: "–ë—é–¥–∂–µ—Ç",
                    value: metrics.totalCost,
                    targetValue: target.total,
                    mode: "max",
                    displayValue: formatCurrency(metrics.totalCost),
                    displayTarget: "‚â§ " + formatCurrency(target.total)
                },
                {
                    label: "–°–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏",
                    value: metrics.validationVelocityDays,
                    targetValue: target.validationDays,
                    mode: "max",
                    displayValue: formatDays(metrics.validationVelocityDays),
                    displayTarget: "‚â§ " + formatDays(target.validationDays)
                },
                {
                    label: "–î–æ–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è",
                    value: metrics.successRate,
                    targetValue: target.successRate,
                    mode: "min",
                    displayValue: formatPct(metrics.successRate),
                    displayTarget: "‚â• " + formatPct(target.successRate)
                }
            ];

            rows.forEach(row => {
                const state = evaluateThreshold(row.value, row.targetValue, row.mode);
                const el = document.createElement("div");
                el.className = "footer-threshold-item";
                el.innerHTML = `
                    <strong>${row.label}</strong>
                    –§–∞–∫—Ç: ${row.displayValue} ‚Ä¢ –ü–æ—Ä–æ–≥: ${row.displayTarget}<br>
                    <span class="kpi-state ${state.className}">${state.text}</span>
                `;
                thresholdGrid.appendChild(el);
            });
        }

        function syncStrategicFilters(selectedCategory) {
            const chips = document.querySelectorAll("#strategicCategoryFilters .chip-btn");
            chips.forEach(chip => {
                chip.classList.toggle("active", chip.dataset.category === selectedCategory);
            });
        }

        function setupStrategicCategoryFilters() {
            const chips = document.querySelectorAll("#strategicCategoryFilters .chip-btn");
            chips.forEach(chip => {
                chip.addEventListener("click", () => {
                    const category = chip.dataset.category || "all";
                    const select = document.getElementById("categoryFilter");
                    if (!select) return;
                    select.value = category;
                    render();
                });
            });
        }

        function render() {
            const period = document.getElementById("periodFilter").value;
            const category = document.getElementById("categoryFilter").value;
            const team = document.getElementById("teamFilter").value;
            const status = document.getElementById("statusFilter").value;
            const maturityKey = document.getElementById("benchmarkMode").value;

            const range = getPeriodRange(period);
            const previousRange = getPreviousRange(range);

            const currentFiltered = applyFilters(hypothesisData, range, { category, team, status });
            const previousFiltered = applyFilters(hypothesisData, previousRange, { category, team, status });

            const currentMetrics = computeMetrics(currentFiltered, range, maturityKey);
            const previousMetrics = computeMetrics(previousFiltered, previousRange, maturityKey);
            const quality = computeDataQuality(currentFiltered);
            const costDiagnostics = getCostDiagnostics(currentFiltered, maturityKey);

            const target = maturityTargets[maturityKey];
            document.getElementById("actionTitle").textContent = buildActionTitle(currentMetrics, target);
            renderHero(currentMetrics, quality, target, costDiagnostics);
            renderKpis(currentMetrics, previousMetrics, target);
            renderActionCards(currentMetrics, quality, maturityKey, costDiagnostics);
            renderFinancialCharts(currentFiltered, currentMetrics, maturityKey, category);
            renderOperationalCharts(currentFiltered, range, currentMetrics, maturityKey);
            renderOutcomeCharts(currentFiltered);
            renderFooterThresholds(currentMetrics, target);
            renderQuality(quality);
            syncStrategicFilters(category);

            const now = new Date();
            document.getElementById("lastUpdated").textContent = "–û–±–Ω–æ–≤–ª–µ–Ω–æ: " + now.toLocaleString("ru-RU");
        }

        function navigateTo(url) {
            if (!url) return;
            document.body.classList.add("page-leaving");
            setTimeout(() => {
                window.location.href = url;
            }, 140);
        }

        function setupPageTransitions() {
            const links = document.querySelectorAll("a.nav-link");
            links.forEach(link => {
                link.addEventListener("click", (event) => {
                    const href = link.getAttribute("href");
                    if (!href || href.startsWith("http")) return;
                    event.preventDefault();
                    navigateTo(href);
                });
            });
        }

        function setupEmbedMode() {
            const params = new URLSearchParams(window.location.search);
            if (params.get("embed") !== "1") return;

            const widget = params.get("widget");
            document.body.classList.add("embed-mode");

            if (!widget) return;
            const target = document.querySelector(`[data-widget="${widget}"]`);
            if (!target) return;

            target.classList.add("embed-active", "span-12");
            target.classList.remove("span-8", "span-6", "span-4");
            const parentSection = target.closest(".dashboard-section");
            if (parentSection) {
                parentSection.classList.add("embed-section");
            }
        }

        fillTeamFilter();
        ["periodFilter", "categoryFilter", "teamFilter", "statusFilter", "benchmarkMode"].forEach(id => {
            document.getElementById(id).addEventListener("change", render);
        });
        setupStrategicCategoryFilters();
        setupPageTransitions();
        render();
        setupEmbedMode();
    </script>
</body>
</html>
